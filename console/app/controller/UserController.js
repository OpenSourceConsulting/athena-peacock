/*
 * File: app/controller/UserController.js
 *
 * This file was generated by Sencha Architect version 3.0.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.UserController', {
    extend: 'Ext.app.Controller',

    onUserGridAfterRender: function(component, eOpts) {
        //RHEVM Grid Data Search
        Ext.getCmp("userGrid").getStore().load();

        var detailPanel = Ext.getCmp("userDetailPanel");
        detailPanel.layout.setActiveItem(0);

    },

    onSearchUserNameKeydown: function(textfield, e, eOpts) {
        //Instance Name Search
        if(e.getKey() == e.ENTER){
            this.searchUser();
        }
    },

    onUserGridSelect: function(rowmodel, record, index, eOpts) {
        //User Grid Item Click

        userConstants.selectRow = record;

        var userDetailPanel = Ext.getCmp("userDetailPanel");
        userDetailPanel.layout.setActiveItem(1);

        //User Data Loading

        var userForm = Ext.getCmp("getUserForm");

        userForm.getForm().reset();

        userForm.getForm().waitMsgTarget = userForm.getEl();

        userForm.getForm().load({
            params : {
                user_id : record.get("user_id")
            }
            ,url : GLOBAL.urlPrefix + "/user/getUser"
            ,waitMsg:'Loading...'
        });

        Ext.getCmp("userTitleLabel").setText("<h2>"+record.get("user_name")+"</h2>", false);

    },

    onUserGridBeforeItemContextMenu: function(dataview, record, item, index, e, eOpts) {
        var position = e.getXY();
        e.stopEvent();

        userConstants.selectRow = record;

        userConstants.contextMenu.showAt(position);
    },

    searchUser: function() {
        //Instances Grid Data Search
        Ext.getCmp("userGrid").getStore().load({
            params:{
                search : Ext.getCmp("searchUserName").getRawValue()
            }
        });

        var detailPanel = Ext.getCmp("userDetailPanel");
        detailPanel.layout.setActiveItem(0);
    },

    init: function(application) {
                //User Menu Config Setting

                var user = this;

                var userGridContextMenu = new Ext.menu.Menu({
                    items:
                    [
                    { text: 'Edit',
                        handler: function() {
                            user.showUserWindow('edit');
                        }
                    }
                    ]

                });

                //User Menu Constants
                Ext.define('userConstants', {
                    singleton: true,
                    me : user,
                    contextMenu: userGridContextMenu,
                    selectRow : null
                });


        this.control({
            "#userGrid": {
                afterrender: this.onUserGridAfterRender,
                select: this.onUserGridSelect,
                beforeitemcontextmenu: this.onUserGridBeforeItemContextMenu
            },
            "#searchUserName": {
                keydown: this.onSearchUserNameKeydown
            }
        });
    },

    showUserWindow: function(type) {
        var userWindow = Ext.create("widget.userWindow");

        userWindow.show();

        if(type == 'edit') {
            var userForm = Ext.getCmp("userForm");

            userForm.getForm().waitMsgTarget = userForm.getEl();

            userForm.getForm().load({
                params : {
                    user_id : userConstants.selectRow.get("user_id")
                }
                ,url : GLOBAL.urlPrefix + "/user/getUser"
                ,waitMsg:'Loading...'
            });
        }


    }

});
