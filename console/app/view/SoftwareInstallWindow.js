/*
 * File: app/view/SoftwareInstallWindow.js
 *
 * This file was generated by Sencha Architect version 3.0.4.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.2.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.2.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.view.SoftwareInstallWindow', {
    extend: 'Ext.window.Window',
    alias: 'widget.SoftwareInstallWindow',

    requires: [
        'Ext.toolbar.Toolbar',
        'Ext.form.field.ComboBox',
        'Ext.button.Button',
        'Ext.form.Panel',
        'Ext.form.FieldSet',
        'Ext.XTemplate',
        'Ext.form.field.TextArea',
        'Ext.form.field.Checkbox',
        'Ext.form.field.Hidden'
    ],

    height: 630,
    id: 'softwareInstallWindow',
    width: 500,
    resizable: false,
    layout: 'border',
    title: 'Software Install Launch Wizard',
    modal: true,

    initComponent: function() {
        var me = this;

        Ext.applyIf(me, {
            dockedItems: [
                {
                    xtype: 'toolbar',
                    dock: 'top',
                    padding: '10 10 0 10',
                    items: [
                        {
                            xtype: 'combobox',
                            id: 'popComboSoftwareName',
                            itemId: 'popComboSoftwareName',
                            width: 350,
                            fieldLabel: 'Software',
                            displayField: 'softwareName',
                            store: 'ComboSoftwareStore',
                            typeAhead: true,
                            valueField: 'softwareName'
                        }
                    ]
                },
                {
                    xtype: 'toolbar',
                    dock: 'bottom',
                    ui: 'footer',
                    layout: {
                        type: 'hbox',
                        pack: 'center'
                    },
                    items: [
                        {
                            xtype: 'button',
                            handler: function(button, e) {

                                var field = Ext.getCmp("popComboSoftwareName"),
                                    softwareStore = field.getStore(),
                                    index = softwareStore.indexOf(softwareStore.findRecord("softwareName", field.getValue()));

                                var installForm;

                                if(index == 0) {

                                    installForm = Ext.getCmp("jbossEWSHttpdForm");

                                } else if(index == 1) {

                                    installForm = Ext.getCmp("jbossEWSTomcatForm");
                                    installForm.getForm().findField("localIPAddress").setValue(instancesConstants.selectRow.get("ipAddr"));

                                    var validFlag = false;
                                    Ext.each(installForm.query('textfield[name="databaseType"]'), function(field, fieldIdx) {
                                        if(field.getValue()) {

                                            var jndiName =  installForm.query('textfield[name="jndiName"]')[fieldIdx];
                                            var connectionUrl =  installForm.query('textfield[name="connectionUrl"]')[fieldIdx];
                                            var userName =  installForm.query('textfield[name="userName"]')[fieldIdx];
                                            var password =  installForm.query('textfield[name="password"]')[fieldIdx];
                                            var maxIdle =  installForm.query('textfield[name="maxIdle"]')[fieldIdx];
                                            var maxActive =  installForm.query('textfield[name="maxActive"]')[fieldIdx];

                                            if(jndiName.getValue() == "") {
                                                jndiName.markInvalid ( 'This field is required' );
                                                validFlag = true;
                                            }

                                            if(connectionUrl.getValue() == "") {
                                                connectionUrl.markInvalid ( 'This field is required' );
                                                validFlag = true;
                                            }

                                            if(userName.getValue() == "") {
                                                userName.markInvalid ( 'This field is required' );
                                                validFlag = true;
                                            }

                                            if(password.getValue() == "") {
                                                password.markInvalid ( 'This field is required' );
                                                validFlag = true;
                                            }

                                            if(maxIdle.getValue() == "") {
                                                maxIdle.markInvalid ( 'This field is required' );
                                                validFlag = true;
                                            }

                                            if(maxActive.getValue() == "") {
                                                maxActive.markInvalid ( 'This field is required' );
                                                validFlag = true;
                                            }

                                        }

                                    });

                                    if(validFlag)
                                    return;

                                } else if(index == 2) {

                                    installForm = Ext.getCmp("jbossEAPForm");
                                    installForm.getForm().findField("localIPAddress").setValue(instancesConstants.selectRow.get("ipAddr"));

                                    var validFlag = false;
                                    Ext.each(installForm.query('textfield[name="databaseType"]'), function(field, fieldIdx) {
                                        if(field.getValue()) {

                                            var jndiName =  installForm.query('textfield[name="jndiName"]')[fieldIdx];
                                            var connectionUrl =  installForm.query('textfield[name="connectionUrl"]')[fieldIdx];
                                            var userName =  installForm.query('textfield[name="userName"]')[fieldIdx];
                                            var password =  installForm.query('textfield[name="password"]')[fieldIdx];
                                            var minPoolSize =  installForm.query('textfield[name="minPoolSize"]')[fieldIdx];
                                            var maxPoolSize =  installForm.query('textfield[name="maxPoolSize"]')[fieldIdx];

                                            if(jndiName.getValue() == "") {
                                                jndiName.markInvalid ( 'This field is required' );
                                                validFlag = true;
                                            }

                                            if(connectionUrl.getValue() == "") {
                                                connectionUrl.markInvalid ( 'This field is required' );
                                                validFlag = true;
                                            }

                                            if(userName.getValue() == "") {
                                                userName.markInvalid ( 'This field is required' );
                                                validFlag = true;
                                            }

                                            if(password.getValue() == "") {
                                                password.markInvalid ( 'This field is required' );
                                                validFlag = true;
                                            }

                                            if(minPoolSize.getValue() == "") {
                                                minPoolSize.markInvalid ( 'This field is required' );
                                                validFlag = true;
                                            }

                                            if(maxPoolSize.getValue() == "") {
                                                maxPoolSize.markInvalid ( 'This field is required' );
                                                validFlag = true;
                                            }

                                        }

                                    });

                                    if(validFlag)
                                    return;

                                }




                                installForm.getForm().findField("machineId").setValue(instancesConstants.selectRow.get("machineId"));

                                installForm.getForm().submit({
                                    clientValidation: true,
                                    url: GLOBAL.urlPrefix + "software/install",
                                    params: {
                                        newStatus: 'delivered'
                                    },
                                    waitMsg: 'Software Install...',
                                    success: function(form, action) {
                                        Ext.Msg.alert('Success', action.result.msg);

                                        Ext.getCmp('instanceSoftwareGrid').getStore().load();

                                        installForm.up('window').close();
                                    },
                                    failure: function(form, action) {

                                        switch (action.failureType) {
                                            case Ext.form.action.Action.CLIENT_INVALID:
                                            Ext.Msg.alert('Failure', '유효하지 않은 입력값이 존재합니다.');
                                            break;
                                            case Ext.form.action.Action.CONNECT_FAILURE:
                                            Ext.Msg.alert('Failure', 'Server communication failed');
                                            break;
                                            case Ext.form.action.Action.SERVER_INVALID:
                                            Ext.Msg.alert('Failure', action.result.msg);
                                        }
                                    }
                                });

                            },
                            id: 'installSofrwareBtn',
                            itemId: 'installSofrwareBtn',
                            margin: '0 15 0 0',
                            padding: '2 5 2 5',
                            text: 'Launch'
                        },
                        {
                            xtype: 'button',
                            handler: function(button, e) {
                                Ext.MessageBox.confirm('Confirm', '작업을 취소하시겠습니까?', function(btn){

                                    if(btn == "yes"){
                                        button.up("window").close();
                                    }

                                });

                            },
                            id: 'installCancelBtn',
                            itemId: 'installCancelBtn',
                            margin: '0 0 0 0',
                            padding: '2 5 2 5',
                            text: 'Cancel'
                        }
                    ]
                }
            ],
            items: [
                {
                    xtype: 'panel',
                    flex: 1,
                    region: 'center',
                    id: 'softwareInstallPanel',
                    itemId: 'softwareInstallPanel',
                    layout: 'card',
                    header: false,
                    title: 'sofrwareInstallPanel',
                    items: [
                        {
                            xtype: 'form',
                            height: 242,
                            id: 'jbossEWSHttpdForm',
                            itemId: 'jbossEWSHttpdForm',
                            autoScroll: true,
                            bodyPadding: 15,
                            fieldDefaults: {
                                msgTarget: 'side',
                                labelWidth: 130
                            },
                            items: [
                                {
                                    xtype: 'fieldset',
                                    title: 'JBoss EWS HTTP Daemon Install',
                                    items: [
                                        {
                                            xtype: 'combobox',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'User',
                                            name: 'user',
                                            allowBlank: false,
                                            displayField: 'account',
                                            store: 'ComboAccountStore',
                                            valueField: 'account',
                                            listeners: {
                                                change: {
                                                    fn: me.onComboboxChange,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'combobox',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Version',
                                            name: 'version',
                                            allowBlank: false,
                                            displayField: 'softwareVersion',
                                            store: 'ComboSoftwareVersionStore',
                                            valueField: 'softwareVersion',
                                            listeners: {
                                                change: {
                                                    fn: me.onMycombobox13Change,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Apache Home',
                                            name: 'apacheHome',
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Server Home',
                                            name: 'serverHome',
                                            readOnly: true,
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'HTTP Port',
                                            name: 'httpPort',
                                            value: 80,
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'HTTPS Port',
                                            name: 'httpsPort',
                                            value: 443,
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textareafield',
                                            anchor: '100%',
                                            margin: '10 0 0 0',
                                            padding: '',
                                            fieldLabel: 'workers.properties',
                                            labelAlign: 'top',
                                            labelStyle: 'font-weight: bold;',
                                            name: 'workers',
                                            rows: 5
                                        },
                                        {
                                            xtype: 'textareafield',
                                            anchor: '100%',
                                            margin: '10 0 5 0',
                                            padding: '',
                                            fieldLabel: 'uriworkermap.properties',
                                            labelAlign: 'top',
                                            labelStyle: 'font-weight: bold;',
                                            name: 'uriworkermap',
                                            rows: 5
                                        },
                                        {
                                            xtype: 'checkboxfield',
                                            fieldLabel: 'Start Service',
                                            name: 'autoStart',
                                            boxLabel: 'Start Service after Installation',
                                            checked: true,
                                            inputValue: 'Y',
                                            uncheckedValue: 'N'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'machineId'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'softwareId'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'softwareName'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'group'
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'form',
                            height: 242,
                            id: 'jbossEWSTomcatForm',
                            itemId: 'jbossEWSTomcatForm',
                            autoScroll: true,
                            bodyPadding: 15,
                            fieldDefaults: {
                                msgTarget: 'side',
                                labelWidth: 130
                            },
                            items: [
                                {
                                    xtype: 'fieldset',
                                    title: 'JBoss EWS Application Server Install',
                                    items: [
                                        {
                                            xtype: 'combobox',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'User',
                                            name: 'user',
                                            allowBlank: false,
                                            displayField: 'account',
                                            store: 'ComboAccountStore',
                                            valueField: 'account',
                                            listeners: {
                                                change: {
                                                    fn: me.onComboboxChange1,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'combobox',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Version',
                                            name: 'version',
                                            allowBlank: false,
                                            displayField: 'softwareVersion',
                                            store: 'ComboSoftwareVersionStore',
                                            valueField: 'softwareVersion',
                                            listeners: {
                                                change: {
                                                    fn: me.onMycombobox13Change1,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Java Home',
                                            name: 'javaHome',
                                            value: '/usr/java/default',
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Server Home',
                                            name: 'serverHome',
                                            readOnly: true,
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Server Name',
                                            name: 'serverName',
                                            allowBlank: false,
                                            enableKeyEvents: true,
                                            listeners: {
                                                keyup: {
                                                    fn: me.onTextfieldKeyup,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Catalina Home',
                                            name: 'catalinaHome',
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Catalina Base',
                                            name: 'catalinaBase',
                                            readOnly: true,
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Encoding',
                                            name: 'encoding',
                                            value: 'UTF-8',
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Port Offset',
                                            name: 'portOffset',
                                            value: 0,
                                            allowBlank: false,
                                            vtype: 'numeric'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Heap Size(MB)',
                                            name: 'heapSize',
                                            value: 1024,
                                            allowBlank: false,
                                            vtype: 'numeric'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Permgen Size(MB)',
                                            name: 'permgenSize',
                                            value: 256,
                                            allowBlank: false,
                                            vtype: 'numeric'
                                        },
                                        {
                                            xtype: 'checkboxfield',
                                            fieldLabel: 'HTTP Enable',
                                            name: 'httpEnable',
                                            boxLabel: 'Check when using HTTP Connector',
                                            checked: true,
                                            inputValue: 'Y',
                                            uncheckedValue: 'N'
                                        },
                                        {
                                            xtype: 'checkboxfield',
                                            fieldLabel: 'High Availability',
                                            name: 'highAvailability',
                                            boxLabel: 'Check when using clustering',
                                            checked: true,
                                            inputValue: 'Y',
                                            uncheckedValue: 'N',
                                            listeners: {
                                                change: {
                                                    fn: me.onCheckboxfieldChange,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'Bind Address',
                                            name: 'bindAddress',
                                            readOnly: true
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'Other Bind Address',
                                            labelWidth: 130,
                                            name: 'otherBindAddress',
                                            readOnly: true
                                        },
                                        {
                                            xtype: 'checkboxfield',
                                            fieldLabel: 'Start Service',
                                            name: 'autoStart',
                                            boxLabel: 'Start Service after Installation',
                                            checked: true,
                                            inputValue: 'Y',
                                            uncheckedValue: 'N'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'machineId'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'softwareId'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'softwareName'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'group'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'localIPAddress'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'toolbar',
                                    padding: '5 0 0 0',
                                    layout: {
                                        type: 'hbox',
                                        pack: 'end'
                                    },
                                    items: [
                                        {
                                            xtype: 'button',
                                            itemId: 'addDataSourceBtn',
                                            text: 'Add DataSource'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'fieldset',
                                    itemId: 'datasourceSet',
                                    title: 'DataSource Setting(Optional)',
                                    items: [
                                        {
                                            xtype: 'combobox',
                                            anchor: '100%',
                                            fieldLabel: 'Database Type',
                                            name: 'databaseType',
                                            store: [
                                                [
                                                    'oracle',
                                                    'Oracle'
                                                ],
                                                [
                                                    'mysql',
                                                    'My-SQL'
                                                ],
                                                [
                                                    'mssql',
                                                    'MS-SQL'
                                                ],
                                                [
                                                    'db2',
                                                    'DB2'
                                                ]
                                            ],
                                            listeners: {
                                                change: {
                                                    fn: me.onComboboxChange2,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'JNDI Name',
                                            name: 'jndiName'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'JDBC URL',
                                            name: 'connectionUrl'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'User Name',
                                            name: 'userName'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'Password',
                                            name: 'password'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'Max Idle',
                                            name: 'maxIdle'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'Max Active',
                                            name: 'maxActive'
                                        },
                                        {
                                            xtype: 'toolbar',
                                            itemId: 'datasourceRemoveToolbar',
                                            layout: {
                                                type: 'hbox',
                                                pack: 'center'
                                            },
                                            items: [
                                                {
                                                    xtype: 'button',
                                                    handler: function(button, e) {
                                                        var form = button.up("form"),
                                                            fieldset = button.up("fieldset");

                                                        form.remove(fieldset);

                                                    },
                                                    text: 'Remove'
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        },
                        {
                            xtype: 'form',
                            height: 242,
                            id: 'jbossEAPForm',
                            itemId: 'jbossEAPForm',
                            autoScroll: true,
                            bodyPadding: 15,
                            fieldDefaults: {
                                msgTarget: 'side',
                                labelWidth: 130
                            },
                            items: [
                                {
                                    xtype: 'fieldset',
                                    title: 'JBoss EAP Install',
                                    items: [
                                        {
                                            xtype: 'combobox',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'User',
                                            name: 'user',
                                            allowBlank: false,
                                            displayField: 'account',
                                            store: 'ComboAccountStore',
                                            valueField: 'account',
                                            listeners: {
                                                change: {
                                                    fn: me.onComboboxChange11,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'combobox',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Version',
                                            name: 'version',
                                            allowBlank: false,
                                            displayField: 'softwareVersion',
                                            store: 'ComboSoftwareVersionStore',
                                            valueField: 'softwareVersion',
                                            listeners: {
                                                change: {
                                                    fn: me.onMycombobox13Change11,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Java Home',
                                            name: 'javaHome',
                                            value: '/usr/java/jdk1.6.0_29',
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'JBoss Home',
                                            name: 'jbossHome',
                                            readOnly: true,
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'combobox',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Base Template',
                                            name: 'baseTemplate',
                                            allowBlank: false,
                                            store: [
                                                'codeServer11',
                                                'codeServer11_cs',
                                                'codeServer21',
                                                'codeServer21_cs'
                                            ],
                                            listeners: {
                                                change: {
                                                    fn: me.onComboboxChange3,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Server Home',
                                            name: 'serverHome',
                                            readOnly: true,
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Server Base',
                                            name: 'serverBase',
                                            readOnly: true,
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Server Name',
                                            name: 'serverName',
                                            allowBlank: false,
                                            enableKeyEvents: true,
                                            listeners: {
                                                keyup: {
                                                    fn: me.onTextfieldKeyup1,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Domain IP',
                                            name: 'domainIp',
                                            value: '0.0.0.0',
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Encoding',
                                            name: 'encoding',
                                            value: 'UTF-8',
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'combobox',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Bind Port',
                                            name: 'bindPort',
                                            allowBlank: false,
                                            store: [
                                                'ports-default',
                                                'ports-01',
                                                'ports-02',
                                                'ports-03'
                                            ]
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'UDP Group Addr',
                                            name: 'udpGroupAddr',
                                            value: '224.0.0.2',
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Multicast Port',
                                            name: 'multicastPort',
                                            value: 42111,
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Server Peer ID',
                                            name: 'serverPeerID',
                                            allowBlank: false,
                                            maxLength: 2,
                                            vtype: 'numeric'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'JVM Route',
                                            name: 'jvmRoute',
                                            allowBlank: false
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Heap Size(MB)',
                                            name: 'heapSize',
                                            value: 1024,
                                            allowBlank: false,
                                            vtype: 'numeric'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            afterLabelTextTpl: [
                                                '<span style="color:red;font-weight:bold" data-qtip="Required">*</span>'
                                            ],
                                            fieldLabel: 'Permgen Size(MB)',
                                            name: 'permgenSize',
                                            value: 256,
                                            allowBlank: false,
                                            vtype: 'numeric'
                                        },
                                        {
                                            xtype: 'checkboxfield',
                                            fieldLabel: 'HTTP Enable',
                                            name: 'httpEnable',
                                            boxLabel: 'Check when using HTTP Connector',
                                            checked: true,
                                            inputValue: 'Y',
                                            uncheckedValue: 'N'
                                        },
                                        {
                                            xtype: 'checkboxfield',
                                            fieldLabel: 'Start Service',
                                            name: 'autoStart',
                                            boxLabel: 'Start Service after Installation',
                                            checked: true,
                                            inputValue: 'Y',
                                            uncheckedValue: 'N'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'machineId'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'softwareId'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'softwareName'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'group'
                                        },
                                        {
                                            xtype: 'hiddenfield',
                                            anchor: '100%',
                                            fieldLabel: 'Label',
                                            name: 'localIPAddress'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'toolbar',
                                    padding: '5 0 0 0',
                                    layout: {
                                        type: 'hbox',
                                        pack: 'end'
                                    },
                                    items: [
                                        {
                                            xtype: 'button',
                                            itemId: 'addDataSourceBtn',
                                            text: 'Add DataSource'
                                        }
                                    ]
                                },
                                {
                                    xtype: 'fieldset',
                                    itemId: 'datasourceSet',
                                    title: 'DataSource Setting(Optional)',
                                    items: [
                                        {
                                            xtype: 'combobox',
                                            anchor: '100%',
                                            fieldLabel: 'Database Type',
                                            name: 'databaseType',
                                            store: [
                                                [
                                                    'oracle',
                                                    'Oracle'
                                                ],
                                                [
                                                    'mysql',
                                                    'My-SQL'
                                                ],
                                                [
                                                    'mssql',
                                                    'MS-SQL'
                                                ],
                                                [
                                                    'db2',
                                                    'DB2'
                                                ]
                                            ],
                                            listeners: {
                                                change: {
                                                    fn: me.onComboboxChange21,
                                                    scope: me
                                                }
                                            }
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'JNDI Name',
                                            name: 'jndiName'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'JDBC URL',
                                            name: 'connectionUrl'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'User Name',
                                            name: 'userName'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'Password',
                                            name: 'password'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'Min Pool Size',
                                            name: 'minPoolSize'
                                        },
                                        {
                                            xtype: 'textfield',
                                            anchor: '100%',
                                            fieldLabel: 'Max Pool Size',
                                            name: 'maxPoolSize'
                                        },
                                        {
                                            xtype: 'toolbar',
                                            itemId: 'datasourceRemoveToolbar',
                                            layout: {
                                                type: 'hbox',
                                                pack: 'center'
                                            },
                                            items: [
                                                {
                                                    xtype: 'button',
                                                    handler: function(button, e) {
                                                        var form = button.up("form"),
                                                            fieldset = button.up("fieldset");

                                                        form.remove(fieldset);

                                                    },
                                                    text: 'Remove'
                                                }
                                            ]
                                        }
                                    ]
                                }
                            ]
                        }
                    ]
                }
            ]
        });

        me.callParent(arguments);
    },

    onComboboxChange: function(field, newValue, oldValue, eOpts) {

        var store = field.getStore();
        var record = store.findRecord("account", newValue);
        var form = field.up('form').getForm();

        form.findField("serverHome").setValue(record.get("homeDir"));
        form.findField("group").setValue(record.get("group"));

        Ext.Ajax.request({
            url: GLOBAL.urlPrefix + "software/getConnectorProp",
            params : {
                account : newValue
            },
            disableCaching : true,
            waitMsg: status + ' Get Properties Data...',
            success: function(response){

                var responseData = Ext.JSON.decode(response.responseText);

                if(responseData.success) {

                    form.findField("workers").setValue(responseData.data.workers);
                    form.findField("uriworkermap").setValue(responseData.data.uriworkermap);

                }

            }
        });

    },

    onMycombobox13Change: function(field, newValue, oldValue, eOpts) {

        var store = field.getStore();
        var record = store.findRecord("softwareVersion", newValue);
        var form = field.up('form').getForm();

        form.findField("softwareId").setValue(record.get("softwareId"));
        form.findField("softwareName").setValue(record.get("softwareName"));

        if(newValue == '2.2.22') {

            form.findField("apacheHome").setValue("/opt/jboss/jboss-ews-2.0/httpd");

        } else if(newValue == '2.2.26') {

            form.findField("apacheHome").setValue("/opt/jboss/jboss-ews-2.1/httpd");


        }

    },

    onComboboxChange1: function(field, newValue, oldValue, eOpts) {

        var store = field.getStore();
        var record = store.findRecord("account", newValue);
        var form = field.up('form').getForm();

        var version = form.findField("version").getValue();

        var homeDir = record.get("homeDir");

        form.findField("serverHome").setValue(homeDir);
        form.findField("serverName").setValue(newValue+"Server21");

        form.findField("catalinaBase").setValue(homeDir + "/Servers/" + form.findField("serverName").getValue());

        form.findField("group").setValue(record.get("group"));

        if(version == "6.0.41") {
            form.findField("catalinaHome").setValue(homeDir+"/jboss-ews-2.1/tomcat6");
        } else if(version == "7.0.54") {
            form.findField("catalinaHome").setValue(homeDir+"/jboss-ews-2.1/tomcat7");
        }

    },

    onMycombobox13Change1: function(field, newValue, oldValue, eOpts) {
        var store = field.getStore();
        var record = store.findRecord("softwareVersion", newValue);
        var form = field.up('form').getForm();

        form.findField("softwareId").setValue(record.get("softwareId"));
        form.findField("softwareName").setValue(record.get("softwareName"));

        var homeDir = form.findField("serverHome").getValue();

        if(newValue == "6.0.41") {
            form.findField("catalinaHome").setValue(homeDir+"/jboss-ews-2.1/tomcat6");
        } else if(newValue == "7.0.54") {
            form.findField("catalinaHome").setValue(homeDir+"/jboss-ews-2.1/tomcat7");
        }

    },

    onTextfieldKeyup: function(textfield, e, eOpts) {
        var form = textfield.up('form').getForm();

        form.findField("catalinaBase").setValue(form.findField("serverHome").getValue() + "/Servers/" + textfield.getValue());

    },

    onCheckboxfieldChange: function(field, newValue, oldValue, eOpts) {
        var form = field.up('form').getForm();

        if(newValue == true) {

            form.findField('bindAddress').setReadOnly(false);
            form.findField('otherBindAddress').setReadOnly(false);

        } else {

            form.findField('bindAddress').setReadOnly(true);
            form.findField('otherBindAddress').setReadOnly(true);

            form.findField('otherBindAddress').setValue("");

        }
    },

    onComboboxChange2: function(field, newValue, oldValue, eOpts) {
        var fieldset = field.up('fieldset');

        if(newValue != '') {
            fieldset.query('textfield[name="maxIdle"]')[0].setValue("1");
            fieldset.query('textfield[name="maxActive"]')[0].setValue("5");

            if(newValue == 'oracle') {

                fieldset.query('textfield[name="connectionUrl"]')[0].setValue("jdbc:oracle:thin:@//{HOST}{:PORT}/{SERVICE}");

            } else if(newValue == 'mysql') {

                fieldset.query('textfield[name="connectionUrl"]')[0].setValue("jdbc:mysql://{HOST}{:PORT}/{DB_NAME}");

            } else if(newValue == 'mssql') {

                fieldset.query('textfield[name="connectionUrl"]')[0].setValue("jdbc:sqlserver://{HOST}{:PORT};databaseName={DB_NAME}");

            } else if(newValue == 'db2') {

                fieldset.query('textfield[name="connectionUrl"]')[0].setValue("jdbc:db2://{HOST}{:PORT}/{DB_NAME}");

            }

        } else {
            fieldset.query('textfield[name="connectionUrl"]')[0].setValue("");
            fieldset.query('textfield[name="maxIdle"]')[0].setValue("");
            fieldset.query('textfield[name="maxActive"]')[0].setValue("");
        }
    },

    onComboboxChange11: function(field, newValue, oldValue, eOpts) {

        var store = field.getStore();
        var record = store.findRecord("account", newValue);
        var form = field.up('form').getForm();

        var version = (form.findField("version").getValue() == null ? "" : form.findField("version").getValue());
        var baseTemplate = (form.findField("baseTemplate").getValue() == null ? "" : form.findField("baseTemplate").getValue());

        var homeDir = record.get("homeDir");

        form.findField("serverHome").setValue(homeDir);
        form.findField("serverBase").setValue(homeDir+"/Servers");

        form.findField("group").setValue(record.get("group"));

        if(baseTemplate.length > 4) {
            baseTemplate = baseTemplate.substring(4, baseTemplate.length);
        }
        form.findField("serverName").setValue(newValue + baseTemplate);

        if(version == "5.1.2") {
            form.findField("jbossHome").setValue(homeDir+"/jboss-eap-5.1");
        } else if(version == "5.2.0") {
            form.findField("jbossHome").setValue(homeDir+"/jboss-eap-5.2");
        }

        if(baseTemplate) {

            if(baseTemplate.indexOf("codeServer11") > -1) {

                form.findField("jvmRoute").setValue(newValue + "_node1");

            } else if(baseTemplate.indexOf("codeServer21") > -1) {

                form.findField("jvmRoute").setValue(newValue + "_node2");
            }
        }


    },

    onMycombobox13Change11: function(field, newValue, oldValue, eOpts) {
        var store = field.getStore();
        var record = store.findRecord("softwareVersion", newValue);
        var form = field.up('form').getForm();

        form.findField("softwareId").setValue(record.get("softwareId"));
        form.findField("softwareName").setValue(record.get("softwareName"));

        var homeDir = form.findField("serverHome").getValue();

        if(newValue == "5.1.2") {
            form.findField("jbossHome").setValue(homeDir+"/jboss-eap-5.1");
        } else if(newValue == "5.2.0") {
            form.findField("jbossHome").setValue(homeDir+"/jboss-eap-5.2");
        }

    },

    onComboboxChange3: function(field, newValue, oldValue, eOpts) {
        var form = field.up('form').getForm();

        var userName = form.findField("user").getValue();

        var baseTemplate = newValue;

        if(baseTemplate.length > 4) {
            baseTemplate = baseTemplate.substring(4, baseTemplate.length);
        }
        form.findField("serverName").setValue(userName + baseTemplate);

        if(newValue.indexOf("codeServer11") > -1) {

            form.findField("serverPeerID").setValue("1");
            form.findField("jvmRoute").setValue(userName + "_node1");

        } else if(newValue.indexOf("codeServer21") > -1) {

            form.findField("serverPeerID").setValue("2");
            form.findField("jvmRoute").setValue(userName + "_node2");
        }
    },

    onTextfieldKeyup1: function(textfield, e, eOpts) {
        form.findField("catalinaBase").setValue(form.findField("serverHome").getValue() + "/Servers/" + textfield.getValue());

    },

    onComboboxChange21: function(field, newValue, oldValue, eOpts) {
        var fieldset = field.up('fieldset');

        if(newValue != '') {
            fieldset.query('textfield[name="minPoolSize"]')[0].setValue("1");
            fieldset.query('textfield[name="maxPoolSize"]')[0].setValue("5");

            if(newValue == 'oracle') {

                fieldset.query('textfield[name="connectionUrl"]')[0].setValue("jdbc:oracle:thin:@//{HOST}{:PORT}/{SERVICE}");

            } else if(newValue == 'mysql') {

                fieldset.query('textfield[name="connectionUrl"]')[0].setValue("jdbc:mysql://{HOST}{:PORT}/{DB_NAME}");

            } else if(newValue == 'mssql') {

                fieldset.query('textfield[name="connectionUrl"]')[0].setValue("jdbc:sqlserver://{HOST}{:PORT};databaseName={DB_NAME}");

            } else if(newValue == 'db2') {

                fieldset.query('textfield[name="connectionUrl"]')[0].setValue("jdbc:db2://{HOST}{:PORT}/{DB_NAME}");

            }

        } else {
            fieldset.query('textfield[name="connectionUrl"]')[0].setValue("");
            fieldset.query('textfield[name="minPoolSize"]')[0].setValue("1");
            fieldset.query('textfield[name="maxPoolSize"]')[0].setValue("5");
        }
    }

});