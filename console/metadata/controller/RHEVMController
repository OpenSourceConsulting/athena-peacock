{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "RHEVMController"
    },
    "designerId": "82c2dbac-191d-44f3-81e3-717d31ea95c9",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#hypervisorGrid",
                "designer|targetType": "Ext.grid.Panel",
                "fn": "onHypervisorRender",
                "implHandler": [
                    "//hypervisor Grid Data Search",
                    "Ext.getCmp(\"hypervisorGrid\").getStore().load();",
                    "",
                    "var detailPanel = Ext.getCmp(\"rhevmDetailPanel\");",
                    "detailPanel.layout.setActiveItem(0);"
                ],
                "name": "afterrender",
                "scope": "me"
            },
            "designerId": "ca2bc19b-3ff9-4cbf-bad4-cc09e59ffe49"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#hypervisorGrid",
                "designer|targetType": "Ext.grid.Panel",
                "fn": "onHypervisorGridSelect",
                "implHandler": [
                    "//RHEVM Grid Item Click",
                    "",
                    "RHEVMConstants.selectRow = record;",
                    "",
                    "var detailPanel = Ext.getCmp(\"rhevmDetailPanel\");",
                    "detailPanel.layout.setActiveItem(1);",
                    "",
                    "Ext.getCmp(\"rhevmTabPanel\").setActiveTab(0);",
                    "",
                    "var detailDPanel = Ext.getCmp(\"rhevmTabDetailPanel\");",
                    "detailDPanel.layout.setActiveItem(0);",
                    "detailDPanel.collapse();",
                    "",
                    "",
                    "//Virtual Machines Data Loading",
                    "var vmGrid = Ext.getCmp('rhevmVMGrid');",
                    "",
                    "vmGrid.getStore().load({",
                    "    params:{",
                    "        hypervisorId : record.get(\"hypervisorId\")",
                    "    }",
                    "});",
                    "",
                    "",
                    "//Template Data Loading",
                    "var templateGrid = Ext.getCmp('rhevmTemplateGrid');",
                    "",
                    "templateGrid.getStore().load({",
                    "    params:{",
                    "        hypervisorId : record.get(\"hypervisorId\")",
                    "    }",
                    "});",
                    ""
                ],
                "name": "select",
                "scope": "me"
            },
            "designerId": "3f6ceed4-9073-4b9e-a8cc-bb6f9c0f953d"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#rhevmTabPanel",
                "designer|targetType": "Ext.tab.Panel",
                "fn": "onRhevmTabPanelTabChange",
                "implHandler": [
                    "var detailTab = Ext.getCmp(\"rhevmTabDetailPanel\");",
                    "detailTab.collapse();",
                    "detailTab.layout.setActiveItem(0);",
                    "",
                    "var grid;",
                    "if(newCard.title == \"Templates\"){",
                    "    grid = Ext.getCmp('rhevmTemplateGrid');",
                    "} else {",
                    "    grid = Ext.getCmp('rhevmVMGrid');",
                    "}",
                    "grid.getStore().reload();"
                ],
                "name": "tabchange",
                "scope": "me"
            },
            "designerId": "165a1414-12b8-4947-91aa-c92cfdc5a987"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#rhevmVMGrid",
                "designer|targetType": "Ext.grid.Panel",
                "fn": "onRhevmVMGridItemClick",
                "implHandler": [
                    "//RHEVM VM Grid Item Click",
                    "var detailTab = Ext.getCmp(\"rhevmTabDetailPanel\");",
                    "detailTab.expand();",
                    "",
                    "detailTab.layout.setActiveItem(1);",
                    "",
                    "RHEVMConstants.childSelectRow = record;",
                    "",
                    "Ext.getCmp(\"rhevmTabDetailTabPanel\").setActiveTab(0);",
                    "",
                    "",
                    "//General Data Loading",
                    "var generalform = Ext.getCmp(\"rhevmGeneralForm\");",
                    "",
                    "generalform.getForm().reset();",
                    "",
                    "generalform.getForm().findField('template').show();",
                    "generalform.getForm().findField('type').hide();",
                    "",
                    "generalform.getForm().waitMsgTarget = generalform.getEl();",
                    "",
                    "generalform.getForm().load({",
                    "    params : {",
                    "        hypervisorId : RHEVMConstants.selectRow.get(\"hypervisorId\"),",
                    "        vmId : record.get(\"vmId\")",
                    "    }",
                    "    ,url : GLOBAL.urlPrefix + \"/rhevm/vms/info\"",
                    "    ,waitMsg:'Loading...'",
                    "});",
                    "",
                    "",
                    "//Network Interfaces Data Loading",
                    "var networkGrid = Ext.getCmp('rhevmNetworkGrid');",
                    "",
                    "networkGrid.columns[6].setVisible(true);",
                    "",
                    "networkGrid.getStore().getProxy().url = GLOBAL.urlPrefix + \"/rhevm/vms/nics\";",
                    "networkGrid.getStore().load({",
                    "    params:{",
                    "        hypervisorId : RHEVMConstants.selectRow.get(\"hypervisorId\"),",
                    "        vmId : record.get(\"vmId\")",
                    "    }",
                    "});",
                    "",
                    "",
                    "//Disk Data Loading",
                    "var diskGrid = Ext.getCmp('rhevmDiskGrid');",
                    "",
                    "diskGrid.columns[1].setVisible(true);",
                    "",
                    "diskGrid.getStore().getProxy().url = GLOBAL.urlPrefix + \"/rhevm/vms/disks\";",
                    "diskGrid.getStore().load({",
                    "    params:{",
                    "        hypervisorId : RHEVMConstants.selectRow.get(\"hypervisorId\"),",
                    "        vmId : record.get(\"vmId\")",
                    "    }",
                    "});",
                    "",
                    "",
                    ""
                ],
                "name": "select",
                "scope": "me"
            },
            "designerId": "3e5fd3cd-6bc4-4809-a35c-05e4ae797829"
        },
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "application"
                ],
                "fn": "init",
                "implHandler": [
                    "var rhevm = this;",
                    "",
                    "var rhevmVMGridContextMenu = new Ext.menu.Menu({",
                    "    items:",
                    "    [",
                    "        { text: 'Start',",
                    "         handler: function() {",
                    "             rhevm.controlVMStatus('Start');",
                    "         }",
                    "        },",
                    "        { text: 'Stop',",
                    "         handler: function() {",
                    "             rhevm.controlVMStatus('Stop');",
                    "         }",
                    "        },",
                    "        { text: 'Shutdown',",
                    "         handler: function() {",
                    "             rhevm.controlVMStatus('Shutdown');",
                    "         }",
                    "        },",
                    "        { text: 'Remove',",
                    "         handler: function() {",
                    "             rhevm.controlVMStatus('Remove');",
                    "         }",
                    "        },",
                    "        { text: 'Export',",
                    "         handler: function() {",
                    "             rhevm.controlVMStatus('Export');",
                    "         }",
                    "        },",
                    "        { text: 'Make Template',",
                    "          handler: function() {",
                    "             rhevm.showTemplateWindow();",
                    "          }",
                    "        }",
                    "    ]",
                    "",
                    "});",
                    "",
                    "//RHEVM Menu Constants",
                    "Ext.define('RHEVMConstants', {",
                    "    singleton: true,",
                    "    contextMenu: rhevmVMGridContextMenu,",
                    "    selectRow : null,",
                    "    childSelectRow : null",
                    "});"
                ]
            },
            "designerId": "8c90bd08-5bc3-487e-a028-e44d03fb7906"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#rhevmVMGrid",
                "designer|targetType": "Ext.grid.Panel",
                "fn": "onRhevmVMGridBeforeItemContextMenu",
                "implHandler": [
                    "var position = e.getXY();",
                    "e.stopEvent();",
                    "",
                    "RHEVMConstants.childSelectRow = record;",
                    "",
                    "var menu = RHEVMConstants.contextMenu;",
                    "var status = record.get('status');",
                    "",
                    "menu.items.each(function( item ) {",
                    "    ",
                    "    if(status == 'up') {",
                    "    ",
                    "        if(item.text == 'Start')\t\t\t\titem.setDisabled(true);",
                    "        else if(item.text == 'Stop')\t\t\titem.setDisabled(false);",
                    "        else if(item.text == 'Shutdown')\t\titem.setDisabled(false);",
                    "        else if(item.text == 'Remove')\t\t\titem.setDisabled(true);",
                    "        else if(item.text == 'Export')\t\t\titem.setDisabled(true);",
                    "        else if(item.text == 'Make Template')\titem.setDisabled(true);",
                    "        ",
                    "    } else if(status == 'down') {",
                    "        ",
                    "        if(item.text == 'Start')\t\t\t\titem.setDisabled(false);",
                    "        else if(item.text == 'Stop')\t\t\titem.setDisabled(true);",
                    "        else if(item.text == 'Shutdown')\t\titem.setDisabled(true);",
                    "        else if(item.text == 'Remove')\t\t\titem.setDisabled(false);",
                    "        else if(item.text == 'Export')\t\t\titem.setDisabled(false);",
                    "        else if(item.text == 'Make Template')\titem.setDisabled(false);",
                    "        ",
                    "    } else {",
                    "        item.setDisabled(true);",
                    "    }",
                    "    ",
                    "});",
                    "",
                    "menu.showAt(position);"
                ],
                "name": "beforeitemcontextmenu",
                "scope": "me"
            },
            "designerId": "1b83a125-6744-43d5-8dea-f4acacae4b13"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#hypervisorGrid",
                "designer|targetType": "Ext.grid.plugin.RowEditing",
                "fn": "onRowEditingEdit",
                "implHandler": [
                    "var record = context.record;",
                    "",
                    "Ext.Ajax.request({",
                    "    url: GLOBAL.urlPrefix + \"/hypervisor/updateHypervisor\",",
                    "    params: {",
                    "        hypervisorId \t: record.get(\"hypervisorId\"),",
                    "        hypervisorType \t: record.get(\"hypervisorType\"),",
                    "        rhevmName \t\t: record.get(\"rhevmName\"),",
                    "        rhevmProtocol \t: record.get(\"rhevmProtocol\"),",
                    "        rhevmPort \t\t: record.get(\"rhevmPort\"),",
                    "        rhevmDomain \t: record.get(\"rhevmDomain\"),",
                    "        rhevmHost \t\t: record.get(\"rhevmHost\"),",
                    "        rhevmUsername \t: record.get(\"rhevmUsername\"),",
                    "        rhevmPassword \t: record.get(\"rhevmPassword\")",
                    "    },",
                    "    disableCaching : true,",
                    "    waitMsg: 'update RHEVM...',",
                    "    success: function(response){",
                    "        var msg = Ext.JSON.decode(response.responseText).msg;",
                    "        Ext.MessageBox.alert('알림', msg);",
                    "",
                    "        Ext.getCmp(\"hypervisorGrid\").getStore().load();",
                    "",
                    "        //Ext.getCmp(\"rhevmDetailPanel\").layout.setActiveItem(0);",
                    "",
                    "    }",
                    "});",
                    ""
                ],
                "name": "edit",
                "scope": "me"
            },
            "designerId": "9827429c-8b7e-4b01-8f9d-b48a6e6f066b"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#rhevmTemplateGrid",
                "designer|targetType": "Ext.grid.Panel",
                "fn": "onRhevmTemplateGridSelect",
                "implHandler": [
                    "//RHEVM VM Grid Item Click",
                    "var detailTab = Ext.getCmp(\"rhevmTabDetailPanel\");",
                    "detailTab.expand();",
                    "",
                    "detailTab.layout.setActiveItem(1);",
                    "",
                    "RHEVMConstants.childSelectRow = record;",
                    "",
                    "Ext.getCmp(\"rhevmTabDetailTabPanel\").setActiveTab(0);",
                    "",
                    "",
                    "//General Data Loading",
                    "var generalform = Ext.getCmp(\"rhevmGeneralForm\");",
                    "",
                    "generalform.getForm().reset();",
                    "",
                    "generalform.getForm().findField('template').hide();",
                    "generalform.getForm().findField('type').show();",
                    "",
                    "generalform.getForm().waitMsgTarget = generalform.getEl();",
                    "",
                    "generalform.getForm().load({",
                    "    params : {",
                    "        hypervisorId : RHEVMConstants.selectRow.get(\"hypervisorId\"),",
                    "        templateId : record.get(\"templateId\")",
                    "    }",
                    "    ,url : GLOBAL.urlPrefix + \"/rhevm/templates/info\"",
                    "    ,waitMsg:'Loading...'",
                    "});",
                    "",
                    "",
                    "//Network Interfaces Data Loading",
                    "var networkGrid = Ext.getCmp('rhevmNetworkGrid');",
                    "",
                    "networkGrid.columns[6].setVisible(false);",
                    "",
                    "networkGrid.getStore().getProxy().url = GLOBAL.urlPrefix + \"/rhevm/templates/nics\";",
                    "networkGrid.getStore().load({",
                    "    params:{",
                    "        hypervisorId : RHEVMConstants.selectRow.get(\"hypervisorId\"),",
                    "        templateId : record.get(\"templateId\")",
                    "    }",
                    "});",
                    "",
                    "",
                    "//Disk Data Loading",
                    "var diskGrid = Ext.getCmp('rhevmDiskGrid');",
                    "",
                    "diskGrid.columns[1].setVisible(false);",
                    "",
                    "diskGrid.getStore().getProxy().url = GLOBAL.urlPrefix + \"/rhevm/templates/disks\";",
                    "diskGrid.getStore().load({",
                    "    params:{",
                    "        hypervisorId : RHEVMConstants.selectRow.get(\"hypervisorId\"),",
                    "        templateId : record.get(\"templateId\")",
                    "    }",
                    "});"
                ],
                "name": "select",
                "scope": "me"
            },
            "designerId": "33c04ce4-a288-4fcd-9152-d8766fedd98c"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "status"
                ],
                "fn": "controlVMStatus",
                "implHandler": [
                    "",
                    "var controlUrl = '';",
                    "",
                    "if(status == 'Start') {",
                    "    ",
                    "    controlUrl = '/rhevm/vms/start';",
                    "    ",
                    "} else if(status == 'Stop') {",
                    "    ",
                    "    controlUrl = '/rhevm/vms/stop';",
                    "    ",
                    "} else if(status == 'Shutdown') {",
                    "    ",
                    "    controlUrl = '/rhevm/vms/shutdown';",
                    "    ",
                    "} else if(status == 'Remove') {",
                    "    ",
                    "    controlUrl = ' /rhevm/vms/remove';",
                    "    ",
                    "} else if(status == 'Export') {",
                    "    ",
                    "    controlUrl = '/rhevm/vms/export';",
                    "    ",
                    "}",
                    "",
                    "Ext.MessageBox.confirm('Confirm', 'VM을 ' + status + '하시겠습니까?', function(btn){",
                    "",
                    "    if(btn == \"yes\"){",
                    "",
                    "        Ext.Ajax.request({",
                    "            url: GLOBAL.urlPrefix + controlUrl,",
                    "            params : {",
                    "                hypervisorId : RHEVMConstants.selectRow.get(\"hypervisorId\"),",
                    "                vmId : RHEVMConstants.childSelectRow.get(\"vmId\")",
                    "            },",
                    "            disableCaching : true,",
                    "            waitMsg: status + ' VM...',",
                    "            success: function(response){",
                    "                var msg = Ext.JSON.decode(response.responseText).msg;",
                    "                Ext.MessageBox.alert('알림', msg);",
                    "",
                    "                Ext.getCmp('rhevmVMGrid').getStore().reload();",
                    "            }",
                    "        });",
                    "    }",
                    "",
                    "});"
                ]
            },
            "designerId": "35727a15-c9ec-4c71-97b8-db3b457623ce"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "showTemplateWindow",
                "implHandler": [
                    "var templateWindow = Ext.create(\"widget.regTemplateWindow\");",
                    "",
                    "templateWindow.show();",
                    "",
                    "var templateForm = Ext.getCmp('templateForm');",
                    "templateForm.getForm().findField('hypervisorId').setRawValue(RHEVMConstants.selectRow.get('hypervisorId'));",
                    "templateForm.getForm().findField('vmId').setRawValue(RHEVMConstants.childSelectRow.get('vmId'));",
                    ""
                ]
            },
            "designerId": "8ae67d63-ac7d-4aba-89ee-be6544f2c220"
        }
    ]
}